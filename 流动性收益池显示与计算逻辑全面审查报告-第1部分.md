# æµåŠ¨æ€§æ”¶ç›Šæ± æ˜¾ç¤ºä¸è®¡ç®—é€»è¾‘å…¨é¢å®¡æŸ¥æŠ¥å‘Š - ç¬¬1éƒ¨åˆ†

## ğŸ“‹ å®¡æŸ¥æ¦‚è¿°

**å®¡æŸ¥ç›®çš„**ï¼šå…¨é¢æ£€æŸ¥å‰ç«¯"æµåŠ¨æ€§æ”¶ç›Šæ± "çš„æ˜¾ç¤ºé€»è¾‘å’Œæ•°æ®æµï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°çš„æ”¶ç›Šé‡‘é¢å‡†ç¡®æ— è¯¯

**å®¡æŸ¥èŒƒå›´**ï¼š
- å‰ç«¯æ•°æ®è·å–æµç¨‹
- å®æ—¶æ”¶ç›Šè®¡ç®—é€»è¾‘
- ç¼“å­˜æœºåˆ¶å’Œé”šå®šæ—¶é—´
- æ•°å­—è·³åŠ¨æ•ˆæœå®ç°
- é¢„è®¡æ¯æ—¥æ”¶ç›Šè®¡ç®—
- æŒå¸å¤©æ•°æ˜¾ç¤º

**å®¡æŸ¥æ—¶é—´**ï¼š2026-01-05

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `rabbit-ai-frontendxin/views/AssetView.tsx`ï¼ˆå‰ç«¯ä¸»æ–‡ä»¶ï¼‰
- `rabbit-ai-frontendxin/api.ts`ï¼ˆAPI è°ƒç”¨ï¼‰
- `rabbit-ai-frontendxin/components/RollingNumber.tsx`ï¼ˆæ•°å­—æ»šåŠ¨ç»„ä»¶ï¼‰

---

## ğŸ¯ ç¬¬1éƒ¨åˆ†ï¼šå‰ç«¯æ˜¾ç¤ºé€»è¾‘å®¡æŸ¥

### ä¸€ã€æ•°æ®è·å–æµç¨‹

#### 1.1 RAT ä½™é¢è·å–

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 56-126 è¡Œ

**è·å–é€»è¾‘**ï¼š
```typescript
// æ­¥éª¤1ï¼šä»é“¾ä¸Šè¯»å– RAT ä½™é¢
const ratContract = await getContract(CONTRACTS.RAT_TOKEN, ABIS.ERC20);
const balanceWei = await callWithRetry(
  () => ratContract.balanceOf(stats.address),
  { maxRetries: 3, baseDelay: 1000 }
);
```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **é‡è¯•æœºåˆ¶**ï¼šä½¿ç”¨ `callWithRetry` å¤„ç† RPC é€Ÿç‡é™åˆ¶ï¼ˆ429 é”™è¯¯ï¼‰ï¼Œæœ€å¤šé‡è¯• 3 æ¬¡
2. **ç²¾åº¦ä¿æŠ¤**ï¼šä½¿ç”¨ `ethers.utils.formatUnits` ä¿æŒç²¾åº¦ï¼Œé¿å… JavaScript æµ®ç‚¹æ•°é—®é¢˜
3. **é™çº§ç­–ç•¥**ï¼šå¦‚æœé“¾ä¸Šè¯»å–å¤±è´¥ï¼Œå°è¯•ä» API è·å–ä½™é¢
4. **é”™è¯¯å¤„ç†**ï¼šåŒºåˆ† 429 é”™è¯¯ï¼ˆé€Ÿç‡é™åˆ¶ï¼‰å’Œå…¶ä»–é”™è¯¯ï¼Œåˆ†åˆ«å¤„ç†

âš ï¸ **æ½œåœ¨é—®é¢˜**ï¼š
1. **æ•°æ®ä¸€è‡´æ€§**ï¼šé“¾ä¸Šä½™é¢å’Œ API ä½™é¢å¯èƒ½ä¸åŒæ­¥
   - é“¾ä¸Šä½™é¢æ˜¯å®æ—¶çš„
   - API ä½™é¢å¯èƒ½æœ‰å»¶è¿Ÿï¼ˆå–å†³äºåç«¯åŒæ­¥é¢‘ç‡ï¼‰
   - å¦‚æœé“¾ä¸Šå¤±è´¥ï¼Œé™çº§åˆ° APIï¼Œå¯èƒ½æ˜¾ç¤ºæ—§æ•°æ®

2. **çŠ¶æ€ç®¡ç†**ï¼š
   ```typescript
   setRatBalance(ratBalanceFromChain);
   setStats(prev => ({ ...prev, ratBalance: ratBalanceFromChain || 0 }));
   ```
   - åŒæ—¶æ›´æ–°ä¸¤ä¸ªçŠ¶æ€ï¼ˆ`ratBalance` å’Œ `stats.ratBalance`ï¼‰
   - å¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

**å»ºè®®**ï¼š
- è€ƒè™‘åœ¨ UI ä¸Šæ˜¾ç¤ºæ•°æ®æ¥æºï¼ˆ"é“¾ä¸Š" vs "API"ï¼‰
- å¦‚æœé“¾ä¸Šè¯»å–å¤±è´¥ï¼Œå¯ä»¥æ˜¾ç¤ºè­¦å‘Šæç¤ºç”¨æˆ·

---

#### 1.2 æ”¶ç›Šæ•°æ®è·å–

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 128-138 è¡Œ

**è·å–é€»è¾‘**ï¼š
```typescript
const earningsData = await fetchEarnings(stats.address);
const pendingUsdtValue = parseFloat(earningsData.pendingUsdt || '0');
setEarnings({
  pendingUsdt: pendingUsdtValue,
  dailyRate: earningsData.dailyRate || 0,
  currentTier: earningsData.currentTier || 0,
  holdingDays: earningsData.holdingDays || 0,
});
```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **API å°è£…**ï¼šé€šè¿‡ `fetchEarnings` ç»Ÿä¸€è·å–æ”¶ç›Šæ•°æ®
2. **é»˜è®¤å€¼å¤„ç†**ï¼šä½¿ç”¨ `|| 0` å¤„ç†ç¼ºå¤±æ•°æ®
3. **ç±»å‹è½¬æ¢**ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼ˆ`parseFloat`ï¼‰

âš ï¸ **æ½œåœ¨é—®é¢˜**ï¼š
1. **æ•°æ®æ–°é²œåº¦**ï¼š`fetchEarnings` è¿”å›çš„æ˜¯åç«¯è®¡ç®—çš„æ”¶ç›Šï¼Œå·²ç»åŒ…å«äº†å¢é‡æ”¶ç›Š
   - åç«¯è®¡ç®—å…¬å¼ï¼š`baseEarnings + incrementalEarnings - totalWithdrawn`
   - å‰ç«¯ä¼šåœ¨æ­¤åŸºç¡€ä¸Šå†æ¬¡è®¡ç®—å¢é‡ï¼Œå¯èƒ½å¯¼è‡´**é‡å¤è®¡ç®—**

2. **é”™è¯¯å¤„ç†ä¸è¶³**ï¼š
   ```typescript
   catch (error) {
     console.error('Failed to fetch earnings:', error);
     setEarningsError(true);
   }
   ```
   - é”™è¯¯æ—¶è®¾ç½® `earningsError = true`ï¼Œä½†æ²¡æœ‰ç”¨æˆ·å‹å¥½çš„æç¤º
   - ç”¨æˆ·åªä¼šçœ‹åˆ° "--" æˆ– loading çŠ¶æ€

**å…³é”®é—®é¢˜**ï¼š
- åç«¯ `pendingUsdt` å·²ç»æ˜¯ `baseEarnings + incrementalEarnings - totalWithdrawn`
- å‰ç«¯å†åŸºäº `pendingUsdt` è®¡ç®—å¢é‡æ”¶ç›Šï¼Œä¼šå¯¼è‡´æ•°å­—ä¸å‡†ç¡®å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼šâŒ **ä¼šå¯¼è‡´ä¸å‡†ç¡®**
- åç«¯ `pendingUsdt` çš„æ—¶é—´ç‚¹ï¼šAPI è°ƒç”¨æ—¶åˆ»
- å‰ç«¯å¢é‡è®¡ç®—çš„æ—¶é—´ç‚¹ï¼šæ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡
- å¦‚æœç¼“å­˜æœºåˆ¶ä¸æ­£ç¡®ï¼Œä¼šå¯¼è‡´åŸºå‡†æ—¶é—´å’ŒåŸºå‡†å€¼ä¸åŒ¹é…

---

### äºŒã€å®æ—¶æ”¶ç›Šè®¡ç®—é€»è¾‘

#### 2.1 åŸºå‡†å€¼å’Œé”šå®šæ—¶é—´

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 140-225 è¡Œ

**æ ¸å¿ƒé€»è¾‘**ï¼š
```typescript
// è®¡ç®—æŒå¸äº§ç”Ÿçš„æ”¶ç›ŠåŸºå‡†å€¼ï¼ˆä¸å«èµ é€ï¼‰
let calculatedBase = 0;
if (earningsData.currentTier > 0 && ratBalanceFromChain !== null) {
  const dailyRate = earningsData.dailyRate || 0;
  const holdingDays = earningsData.holdingDays || 0;
  // æŒå¸æ”¶ç›Š = æŒå¸é‡ Ã— $0.01 Ã— æ—¥åˆ©ç‡ Ã— æŒå¸å¤©æ•°
  calculatedBase = ratBalanceFromChain * 0.01 * (dailyRate / 100) * holdingDays;
}

setEarningsBaseValue(pendingUsdtValue); // åŒ…å«èµ é€çš„USDT
setCalculatedEarningsBase(calculatedBase); // ä»…æŒå¸æ”¶ç›Š
```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **åŒºåˆ†èµ é€å’ŒæŒå¸æ”¶ç›Š**ï¼š
   - `earningsBaseValue`ï¼šAPI è¿”å›çš„æ€»æ”¶ç›Šï¼ˆåŒ…å«ç®¡ç†å‘˜èµ é€çš„ USDTï¼‰
   - `calculatedEarningsBase`ï¼šå‰ç«¯è®¡ç®—çš„æŒå¸æ”¶ç›Šï¼ˆä¸å«èµ é€ï¼‰
   - `giftedUsdt = earningsBaseValue - calculatedEarningsBase`ï¼ˆç®¡ç†å‘˜èµ é€çš„ USDTï¼‰

2. **ç²¾ç¡®è®¡ç®—**ï¼šä½¿ç”¨æŒå¸å¤©æ•° Ã— æ—¥åˆ©ç‡è®¡ç®—æŒå¸æ”¶ç›Š

âš ï¸ **æ½œåœ¨é—®é¢˜**ï¼š

**é—®é¢˜1ï¼šå‰ç«¯è®¡ç®—çš„ `calculatedBase` ä¸åç«¯è®¡ç®—å¯èƒ½ä¸ä¸€è‡´**

å‰ç«¯è®¡ç®—å…¬å¼ï¼š
```
calculatedBase = ratBalance Ã— 0.01 Ã— (dailyRate / 100) Ã— holdingDays
```

åç«¯è®¡ç®—å…¬å¼ï¼ˆ`earnings.ts` ç¬¬ 324 è¡Œï¼‰ï¼š
```typescript
incrementalEarnings = balance Ã— TOKEN_PRICE Ã— (dailyRate / 100) Ã— daysElapsed
grossEarnings = baseEarnings + incrementalEarnings
```

**å·®å¼‚**ï¼š
- å‰ç«¯ä½¿ç”¨ `holdingDays`ï¼ˆä»é¦–æ¬¡é¢†å–åˆ°ç°åœ¨çš„æ€»å¤©æ•°ï¼‰
- åç«¯ä½¿ç”¨ `daysElapsed`ï¼ˆä» `last_settlement_time` åˆ°ç°åœ¨çš„å¤©æ•°ï¼‰
- è¿™ä¸¤ä¸ªå€¼å¯èƒ½**å®Œå…¨ä¸åŒ**ï¼

**ä¸¾ä¾‹**ï¼š
- ç”¨æˆ·åœ¨ 2025-12-29 é¦–æ¬¡é¢†å–ï¼ˆ`holdingDays` ä»è¿™å¤©å¼€å§‹ï¼‰
- ç®¡ç†å‘˜åœ¨ 2026-01-04 èµ é€äº† 5 USDTï¼Œæ›´æ–°äº† `last_settlement_time`ï¼ˆ`daysElapsed` ä»è¿™å¤©å¼€å§‹ï¼‰
- å‰ç«¯è®¡ç®—ï¼š`calculatedBase` åŸºäº 7 å¤©
- åç«¯è®¡ç®—ï¼š`incrementalEarnings` åŸºäº 1 å¤©
- `giftedUsdt = åç«¯pendingUsdt - å‰ç«¯calculatedBase` ä¼šæ˜¯**è´Ÿæ•°**ï¼

**é—®é¢˜2ï¼šç®¡ç†å‘˜èµ é€ USDT åï¼Œå‰ç«¯è®¡ç®—ä¼šå‡ºé”™**

å¦‚æœç®¡ç†å‘˜èµ é€ USDT å¹¶æ›´æ–°äº† `last_settlement_time`ï¼š
- åç«¯ `pendingUsdt` å˜å°ï¼ˆå› ä¸º `daysElapsed` é‡ç½®ï¼‰
- å‰ç«¯ `calculatedBase` å˜å¤§ï¼ˆå› ä¸º `holdingDays` æŒç»­å¢åŠ ï¼‰
- `giftedUsdt` ä¼šå˜æˆè´Ÿæ•°ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯

---

#### 2.2 ç¼“å­˜å’Œé”šå®šæ—¶é—´é€»è¾‘

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 157-225 è¡Œ

**ç¼“å­˜æœºåˆ¶**ï¼š
```typescript
const STORE_KEY = `rabbit_earnings_anchor_${stats.address.toLowerCase()}`;
const CACHE_EXPIRY_MS = 5 * 60 * 1000; // 5 åˆ†é’Ÿç¼“å­˜è¿‡æœŸ

// è¯»å–ç¼“å­˜
const stored = localStorage.getItem(STORE_KEY);
const { baseValue, timestamp } = JSON.parse(stored);

// æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
if (cacheAge >= CACHE_EXPIRY_MS) {
  // ç¼“å­˜è¿‡æœŸï¼Œé‡ç½®é”šå®šæ—¶é—´
  anchorTime = Date.now();
} else {
  // ç¼“å­˜æœªè¿‡æœŸï¼Œæ£€æŸ¥é‡‘é¢æ˜¯å¦å˜åŒ–
  const amountDiff = pendingUsdtValue - baseValue;
  
  if (amountDiffAbs < 0.01 || amountDiff >= 0) {
    // é‡‘é¢å˜åŒ–å¾ˆå°æˆ–å¢åŠ ï¼Œä¿æŒæ—§æ—¶é—´æˆ³
    anchorTime = timestamp;
  } else {
    // é‡‘é¢å‡å°‘ï¼ˆæç°ï¼‰ï¼Œé‡ç½®é”šå®šæ—¶é—´
    anchorTime = Date.now();
  }
}
```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **ç¼“å­˜è¿‡æœŸæœºåˆ¶**ï¼š5 åˆ†é’Ÿåå¼ºåˆ¶åˆ·æ–°ï¼Œé¿å…é•¿æ—¶é—´ä½¿ç”¨æ—§æ•°æ®
2. **é‡‘é¢å˜åŒ–æ£€æµ‹**ï¼šæ ¹æ®é‡‘é¢å˜åŒ–å†³å®šæ˜¯å¦é‡ç½®é”šå®šæ—¶é—´
3. **å¹³æ»‘ä½“éªŒ**ï¼šé‡‘é¢å˜åŒ–å°æ—¶ä¿æŒæ—§æ—¶é—´æˆ³ï¼Œè®©æ•°å­—è¿ç»­æ»šåŠ¨

âš ï¸ **æ½œåœ¨é—®é¢˜**ï¼š

**é—®é¢˜1ï¼šç¼“å­˜è¿‡æœŸåï¼Œå‰ç«¯è®¡ç®—ä¼šè·³å˜**

- ç¼“å­˜è¿‡æœŸå‰ï¼š`anchorTime` = 5 åˆ†é’Ÿå‰ï¼Œå¢é‡æ”¶ç›Šç´¯ç§¯äº† 5 åˆ†é’Ÿ
- ç¼“å­˜è¿‡æœŸåï¼š`anchorTime` = å½“å‰æ—¶é—´ï¼Œå¢é‡æ”¶ç›Šé‡ç½®ä¸º 0
- ç”¨æˆ·ä¼šçœ‹åˆ°æ•°å­—**çªç„¶å‡å°‘**ï¼ˆä»é«˜ç‚¹è·³å›åŸºå‡†å€¼ï¼‰

**é—®é¢˜2ï¼šæç°åçš„é”šå®šæ—¶é—´é‡ç½®é€»è¾‘ä¸å®Œå–„**

```typescript
} else {
  // é‡‘é¢å‡å°‘ï¼ˆæç°ï¼‰ï¼Œé‡ç½®é”šå®šæ—¶é—´
  anchorTime = Date.now();
  localStorage.setItem(STORE_KEY, JSON.stringify({
    baseValue: pendingUsdtValue,
    timestamp: Date.now()
  }));
}
```

- æç°åï¼Œ`pendingUsdtValue` å·²ç»æ‰£é™¤äº†æç°é‡‘é¢
- å‰ç«¯é‡ç½® `anchorTime` ä¸ºå½“å‰æ—¶é—´
- ä½†åç«¯çš„ `last_settlement_time` **æ²¡æœ‰é‡ç½®**ï¼ˆå·²ä¿®å¤ï¼‰
- å‰ç«¯å¢é‡æ”¶ç›Šä» 0 å¼€å§‹ï¼Œåç«¯å¢é‡æ”¶ç›Šä»æ—§çš„ `last_settlement_time` å¼€å§‹
- ä¼šå¯¼è‡´å‰ç«¯æ˜¾ç¤ºåå°

**é—®é¢˜3ï¼šç®¡ç†å‘˜èµ é€ USDT åï¼Œç¼“å­˜é€»è¾‘ä¼šè¯¯åˆ¤**

- ç®¡ç†å‘˜èµ é€ 5 USDT
- `pendingUsdtValue` å¢åŠ ï¼ˆ`amountDiff > 0`ï¼‰
- å‰ç«¯åˆ¤æ–­ä¸º"é‡‘é¢å¢åŠ ï¼Œä¿æŒæ—§æ—¶é—´æˆ³"
- ä½†å®é™…ä¸Šåº”è¯¥é‡ç½®æ—¶é—´æˆ³ï¼Œå› ä¸ºåç«¯çš„ `last_settlement_time` å·²ç»æ›´æ–°

---

#### 2.3 å®æ—¶æ”¶ç›Šè®¡ç®—

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 517-581 è¡Œ

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
// è®¡ç®—æ¯æ—¥æ”¶ç›Šä¸Šé™
const giftedUsdt = earningsBaseValue - calculatedEarningsBase;
const maxDailyEarnings = calculatedEarningsBase + estimatedDailyEarnings + giftedUsdt;

// è®¡ç®—å¢é‡æ”¶ç›Š
const now = Date.now();
const timeElapsed = (now - earningsBaseTime) / (1000 * 60); // åˆ†é’Ÿ
const minutesPerDay = 24 * 60;
const incrementalEarnings = estimatedDailyEarnings * (timeElapsed / minutesPerDay);

// å®æ—¶æ”¶ç›Š = æŒå¸åŸºå‡† + å¢é‡æ”¶ç›Š + èµ é€USDT
const newRealTimeEarnings = calculatedEarningsBase + incrementalEarnings + giftedUsdt;

// é™åˆ¶ï¼šä¸è¶…è¿‡æ¯æ—¥æ”¶ç›Šä¸Šé™
const cappedEarnings = Math.min(newRealTimeEarnings, maxDailyEarnings);
```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **å®æ—¶æ›´æ–°**ï¼šæ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡ï¼Œç»™ç”¨æˆ·æµç•…çš„ä½“éªŒ
2. **ä¸Šé™ä¿æŠ¤**ï¼šä¸è¶…è¿‡æ¯æ—¥æ”¶ç›Šä¸Šé™ï¼Œé˜²æ­¢æ˜¾ç¤ºå¼‚å¸¸å€¼
3. **å¹³æ»‘æ»šåŠ¨**ï¼šå¢é‡æ”¶ç›Šæ˜¯çº¿æ€§ç´¯ç§¯çš„ï¼Œæ•°å­—å¹³æ»‘å¢é•¿

âš ï¸ **æ½œåœ¨é—®é¢˜**ï¼š

**é—®é¢˜1ï¼š`calculatedEarningsBase` è®¡ç®—ä¸å‡†ç¡®**

å¦‚å‰æ‰€è¿°ï¼Œ`calculatedEarningsBase` ä½¿ç”¨ `holdingDays`ï¼Œè€Œä¸æ˜¯åç«¯çš„ `daysElapsed`ï¼Œä¼šå¯¼è‡´ï¼š
- å‰ç«¯è®¤ä¸ºçš„"æŒå¸æ”¶ç›ŠåŸºå‡†"ä¸åç«¯ä¸ä¸€è‡´
- `giftedUsdt` è®¡ç®—é”™è¯¯
- å®æ—¶æ”¶ç›Šæ˜¾ç¤ºé”™è¯¯

**é—®é¢˜2ï¼š`estimatedDailyEarnings` ä¸åç«¯å¢é‡é€Ÿç‡ä¸åŒ¹é…**

å‰ç«¯è®¡ç®—ï¼š
```typescript
const estimatedDailyEarnings = ratBalance * 0.01 * (dailyRate / 100);
```

åç«¯è®¡ç®—ï¼ˆæ¯æ¬¡ API è°ƒç”¨æ—¶ï¼‰ï¼š
```typescript
const incrementalEarnings = balance * 0.01 * (dailyRate / 100) * daysElapsed;
```

- å‰ç«¯å‡è®¾ï¼šæ¯å¤©å¢åŠ å›ºå®šé‡‘é¢ï¼ˆ`estimatedDailyEarnings`ï¼‰
- åç«¯å®é™…ï¼šä» `last_settlement_time` å¼€å§‹ç´¯ç§¯
- å¦‚æœ `last_settlement_time` è¢«é‡ç½®ï¼ˆå¦‚ç®¡ç†å‘˜èµ é€ USDTï¼‰ï¼Œå‰ç«¯å’Œåç«¯çš„å¢é‡é€Ÿç‡ä¼šä¸åŒæ­¥

**é—®é¢˜3ï¼šæ•°å­—è·³åŠ¨çš„èµ·ç‚¹ä¸æ­£ç¡®**

- å‰ç«¯ä» `calculatedEarningsBase + giftedUsdt` å¼€å§‹è·³åŠ¨
- åç«¯ä» `baseEarnings + incrementalEarnings - totalWithdrawn` å¼€å§‹
- å¦‚æœä¸¤ä¸ªåŸºå‡†ä¸åŒï¼Œæ•°å­—ä¼šä»é”™è¯¯çš„èµ·ç‚¹å¼€å§‹è·³åŠ¨

---

### ä¸‰ã€é¢„è®¡æ¯æ—¥æ”¶ç›Šè®¡ç®—

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 491-515 è¡Œ

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
const estimatedDailyEarnings = useMemo(() => {
  if (!currentTier || !earnings || ratBalance === null) return null;
  
  try {
    const balanceWei = ethers.utils.parseEther(ratBalance.toString());
    const priceWei = ethers.utils.parseEther(RAT_PRICE_USDT.toString());
    const ratePercent = currentTier.dailyRate; // ä¾‹å¦‚ 2%
    
    // è®¡ç®—ï¼šbalanceWei * priceWei * ratePercent / (1e18 * 100)
    const resultWei = balanceWei
      .mul(priceWei)
      .mul(ethers.BigNumber.from(ratePercent))
      .div(ethers.utils.parseEther('100'));
    
    return parseFloat(ethers.utils.formatEther(resultWei));
  } catch (error) {
    // é™çº§åˆ°æ™®é€šè®¡ç®—
    return ratBalance * RAT_PRICE_USDT * (currentTier.dailyRate / 100);
  }
}, [ratBalance, currentTier, earnings]);
```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **ä¼˜ç‚¹**ï¼š
1. **é«˜ç²¾åº¦è®¡ç®—**ï¼šä½¿ç”¨ `ethers.BigNumber` é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
2. **é™çº§ç­–ç•¥**ï¼šå¦‚æœ BigNumber è®¡ç®—å¤±è´¥ï¼Œä½¿ç”¨æ™®é€š JavaScript è®¡ç®—
3. **ä¾èµ–ç®¡ç†**ï¼šä½¿ç”¨ `useMemo` ä¼˜åŒ–æ€§èƒ½ï¼Œåªåœ¨ä¾èµ–å˜åŒ–æ—¶é‡æ–°è®¡ç®—

âœ… **è®¡ç®—æ­£ç¡®**ï¼š
- å…¬å¼ï¼š`ratBalance Ã— $0.01 Ã— (dailyRate / 100)`
- ä¸åç«¯ä¸€è‡´

---

### å››ã€æŒå¸å¤©æ•°æ˜¾ç¤º

**ä»£ç ä½ç½®**ï¼š`AssetView.tsx` ç¬¬ 795-810 è¡Œ

**æ˜¾ç¤ºé€»è¾‘**ï¼š
```typescript
<div className="flex justify-between items-center">
  <span className="text-[10px] text-[#848E9C]">æŒå¸å¤©æ•°</span>
  <span className="text-sm font-black text-white mono">
    {earnings.holdingDays} å¤©
  </span>
</div>
```

**æ•°æ®æ¥æº**ï¼š
- åç«¯ API è¿”å›çš„ `holdingDays`
- è®¡ç®—å…¬å¼ï¼ˆ`earnings.ts` ç¬¬ 333 è¡Œï¼‰ï¼š
  ```typescript
  const startTime = new Date(firstClaim.created_at).getTime();
  const daysHolding = Math.max(0, (now - startTime) / (24 * 3600 * 1000));
  return Math.floor(daysHolding); // æ˜¾ç¤ºæ—¶å–æ•´
  ```

**å®¡æŸ¥ç»“æœ**ï¼š

âœ… **æ˜¾ç¤ºæ­£ç¡®**ï¼š
- ä»é¦–æ¬¡é¢†å–ç©ºæŠ•å¼€å§‹è®¡ç®—
- ä½¿ç”¨ `Math.floor` å–æ•´ï¼Œç¬¦åˆç”¨æˆ·é¢„æœŸ

---

## ğŸ“Š ç¬¬1éƒ¨åˆ†å®¡æŸ¥æ€»ç»“

### âœ… å‰ç«¯æ˜¾ç¤ºçš„ä¼˜ç‚¹

1. **ç”¨æˆ·ä½“éªŒå¥½**ï¼š
   - å®æ—¶æ•°å­—è·³åŠ¨æ•ˆæœï¼ˆ5 ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
   - å¹³æ»‘çš„æ•°å­—å¢é•¿
   - é«˜ç²¾åº¦è®¡ç®—ï¼ˆBigNumberï¼‰

2. **å®¹é”™æ€§å¼º**ï¼š
   - RPC è°ƒç”¨æœ‰é‡è¯•æœºåˆ¶
   - é™çº§ç­–ç•¥ï¼ˆé“¾ä¸Šå¤±è´¥ â†’ APIï¼‰
   - é”™è¯¯çŠ¶æ€å¤„ç†

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ç»“æœ
   - ä½¿ç”¨ `localStorage` ç¼“å­˜é”šå®šæ—¶é—´

### âš ï¸ å‘ç°çš„å…³é”®é—®é¢˜

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|------|----------|------|
| å‰ç«¯ `calculatedBase` ä½¿ç”¨ `holdingDays`ï¼Œåç«¯ä½¿ç”¨ `daysElapsed` | ğŸ”´ é«˜ | ç®¡ç†å‘˜èµ é€ USDT åï¼Œ`giftedUsdt` è®¡ç®—é”™è¯¯ï¼Œå¯èƒ½ä¸ºè´Ÿæ•° |
| ç¼“å­˜è¿‡æœŸåæ•°å­—è·³å˜ | ğŸŸ¡ ä¸­ | ç”¨æˆ·ä½“éªŒå·®ï¼Œæ•°å­—çªç„¶å‡å°‘ |
| æç°åé”šå®šæ—¶é—´é‡ç½®ä¸å®Œå–„ | ğŸŸ¡ ä¸­ | å‰ç«¯æ˜¾ç¤ºåå°ï¼Œä¸åç«¯ä¸ä¸€è‡´ |
| ç®¡ç†å‘˜èµ é€åç¼“å­˜é€»è¾‘è¯¯åˆ¤ | ğŸŸ¡ ä¸­ | åº”è¯¥é‡ç½®é”šå®šæ—¶é—´ï¼Œä½†å‰ç«¯ä¿æŒæ—§æ—¶é—´æˆ³ |
| RAT ä½™é¢é“¾ä¸Š/API ä¸ä¸€è‡´ | ğŸŸ¢ ä½ | å¯èƒ½æ˜¾ç¤ºæ—§ä½™é¢ï¼Œä½†å½±å“å° |

### ğŸ¯ æ ¸å¿ƒé—®é¢˜

**å‰ç«¯å’Œåç«¯çš„æ”¶ç›Šè®¡ç®—åŸºå‡†ä¸åŒæ­¥**ï¼š

| ç»´åº¦ | å‰ç«¯ | åç«¯ |
|------|------|------|
| **æ—¶é—´åŸºå‡†** | `holdingDays`ï¼ˆä»é¦–æ¬¡é¢†å–å¼€å§‹ï¼‰ | `daysElapsed`ï¼ˆä» `last_settlement_time` å¼€å§‹ï¼‰ |
| **æ”¶ç›ŠåŸºå‡†** | `calculatedEarningsBase`ï¼ˆå‰ç«¯è®¡ç®—ï¼‰ | `baseEarnings`ï¼ˆæ•°æ®åº“ `usdt_total`ï¼‰ |
| **å¢é‡è®¡ç®—** | åŸºäº `estimatedDailyEarnings` å’Œ `anchorTime` | åŸºäº `incrementalEarnings` å’Œ `last_settlement_time` |

**å¯¼è‡´çš„é—®é¢˜**ï¼š
1. ç®¡ç†å‘˜èµ é€ USDT åï¼Œåç«¯æ›´æ–° `last_settlement_time`ï¼Œä½†å‰ç«¯ä¸çŸ¥é“
2. å‰ç«¯ç»§ç»­ä½¿ç”¨æ—§çš„ `holdingDays` è®¡ç®— `calculatedBase`
3. `giftedUsdt = pendingUsdtValue - calculatedBase` å˜æˆè´Ÿæ•°
4. å®æ—¶æ”¶ç›Šæ˜¾ç¤ºé”™è¯¯

---

## ğŸ”— ä¸‹ä¸€æ­¥

è¯·æŸ¥çœ‹**ç¬¬2éƒ¨åˆ†ï¼šåç«¯è®¡ç®—é€»è¾‘å®¡æŸ¥**ï¼Œäº†è§£åç«¯å¦‚ä½•è®¡ç®—æ”¶ç›Šï¼Œä»¥åŠå¦‚ä½•ä¸å‰ç«¯ååŒå·¥ä½œã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š2026-01-05  
**å®¡æŸ¥çŠ¶æ€**ï¼šâœ… ç¬¬1éƒ¨åˆ†å®Œæˆ  
**ä¸‹ä¸€æ­¥**ï¼šå®¡æŸ¥åç«¯è®¡ç®—é€»è¾‘ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰

