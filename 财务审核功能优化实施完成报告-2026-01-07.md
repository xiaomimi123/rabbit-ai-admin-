# è´¢åŠ¡å®¡æ ¸åŠŸèƒ½ä¼˜åŒ–å®æ–½å®ŒæˆæŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-01-07  
**å®æ–½èŒƒå›´**: åå°ç®¡ç†é¡µé¢ - è´¢åŠ¡å®¡æ ¸åŠŸèƒ½  
**å®æ–½ç›®æ ‡**: ä¼˜åŒ–3ä¸ªé—®é¢˜ + æ–°å¢ç”¨æˆ·ç”»åƒåŠŸèƒ½

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æˆåŠŸå®æ–½äº†è´¢åŠ¡å®¡æ ¸åŠŸèƒ½çš„ä¼˜åŒ–å’Œæ–°åŠŸèƒ½æ·»åŠ ï¼ŒåŒ…æ‹¬ï¼š
1. âœ… **æ˜¾ç¤ºé”å®šçš„èƒ½é‡å€¼**: åœ¨æç°å¡ç‰‡ä¸­æ˜¾ç¤ºæœ¬æ¬¡æç°æ¶ˆè€—çš„èƒ½é‡
2. âœ… **äº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯**: å‰ç«¯æ·»åŠ æ ¼å¼éªŒè¯ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
3. âœ… **å‘Šè­¦åŠŸèƒ½ä½¿ç”¨**: å¤§é¢æç°æ˜¾ç¤ºå‘Šè­¦æ ‡å¿—å’Œç‰¹æ®Šæ ·å¼
4. âœ… **ç”¨æˆ·ç”»åƒåŠŸèƒ½**: æ˜¾ç¤ºç”¨æˆ·çš„æŒä»“ã€èƒ½é‡ã€æ”¶ç›Šã€VIPç­‰çº§ï¼Œå¸®åŠ©ç®¡ç†å‘˜è¯†åˆ«å¼‚å¸¸è´¦æˆ·

---

## ğŸ”§ å®æ–½å†…å®¹

### 1. åç«¯ä¿®æ”¹ (`rabbit-ai-backend/src/services/admin.ts`)

#### 1.1 ä¿®æ”¹ `listPendingWithdrawals` å‡½æ•°

**ä½ç½®**: ç¬¬ 274-357 è¡Œ

**ä¿®æ”¹å†…å®¹**:
- âœ… æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·ç”»åƒæ•°æ®ï¼ˆå…³è” `users` è¡¨ï¼‰
- âœ… è·å– RAT æŒä»“ã€èƒ½é‡ã€æ”¶ç›Šã€VIPç­‰çº§
- âœ… å°†ç”¨æˆ·ç”»åƒæ•°æ®åˆå¹¶åˆ°è¿”å›ç»“æœä¸­

**å…³é”®ä»£ç **:
```typescript
// ğŸŸ¢ æ–°å¢ï¼šæ‰¹é‡æŸ¥è¯¢ç”¨æˆ·ç”»åƒæ•°æ®
const addresses = (data || []).map((r: any) => r.address.toLowerCase());
const { data: usersData, error: usersError } = await supabase
  .from('users')
  .select('address,rat_balance_wei,energy_total,energy_locked,usdt_total')
  .in('address', addresses);

// åˆ›å»ºåœ°å€åˆ°ç”¨æˆ·æ•°æ®çš„æ˜ å°„
const usersMap = new Map();
(usersData || []).forEach((u: any) => {
  usersMap.set(u.address.toLowerCase(), u);
});

// è®¡ç®—ç”¨æˆ·ç”»åƒæ•°æ®
const user = usersMap.get(userAddr);
if (user) {
  // RAT æŒä»“ï¼ˆä» Wei è½¬æ¢ä¸º RATï¼‰
  const ratBalanceWei = user.rat_balance_wei || '0';
  ratBalance = parseFloat(ethers.utils.formatEther(ratBalanceWei));
  
  // å¯ç”¨èƒ½é‡
  const energyTotal = Number(user.energy_total || 0);
  const energyLocked = Number(user.energy_locked || 0);
  energyAvailable = Math.max(0, energyTotal - energyLocked);
  
  // ç´¯è®¡æ”¶ç›Š
  totalEarnings = Number(user.usdt_total || 0);
  
  // VIP ç­‰çº§
  const vipInfo = getVipTierByBalance(ratBalance);
  vipLevel = vipInfo.tier;
}

// è¿”å›ç»“æœä¸­åŒ…å«ç”¨æˆ·ç”»åƒ
return {
  // ... åŸæœ‰å­—æ®µ
  userStats: {
    ratBalance,
    energyAvailable,
    totalEarnings,
    vipLevel,
  },
};
```

---

### 2. å‰ç«¯ä¿®æ”¹

#### 2.1 ç±»å‹å®šä¹‰ (`rabbit-ai-admin/types.ts`)

**ä¿®æ”¹å†…å®¹**: æ‰©å±• `Withdrawal` æ¥å£

```typescript
export interface Withdrawal {
  id: string;
  address: string;
  amount: number;
  status: 'Pending' | 'Completed' | 'Rejected';
  createdAt: string;
  energyLockedAmount?: number; // ğŸŸ¢ æ–°å¢ï¼šæœ¬æ¬¡æç°é”å®šçš„èƒ½é‡å€¼
  alert?: boolean; // ğŸŸ¢ æ–°å¢ï¼šæ˜¯å¦å‘Šè­¦
  userStats?: { // ğŸŸ¢ æ–°å¢ï¼šç”¨æˆ·ç”»åƒæ•°æ®
    ratBalance: number; // RAT æŒä»“
    energyAvailable: number; // å¯ç”¨èƒ½é‡
    totalEarnings: number; // ç´¯è®¡æ”¶ç›Š
    vipLevel: number; // VIP ç­‰çº§
  };
}
```

#### 2.2 API ç±»å‹å®šä¹‰ (`rabbit-ai-admin/lib/api.ts`)

**ä¿®æ”¹å†…å®¹**: æ›´æ–° `getPendingWithdrawals` è¿”å›ç±»å‹

```typescript
export async function getPendingWithdrawals(limit = 50) {
  return apiFetch<{
    ok: boolean;
    items: Array<{
      // ... åŸæœ‰å­—æ®µ
      userStats?: { // ğŸŸ¢ æ–°å¢
        ratBalance: number;
        energyAvailable: number;
        totalEarnings: number;
        vipLevel: number;
      };
    }>;
  }>(`/admin/withdrawals/pending?limit=${limit}`);
}
```

#### 2.3 è´¢åŠ¡å®¡æ ¸é¡µé¢ (`rabbit-ai-admin/pages/FinanceOps.tsx`)

**ä¿®æ”¹å†…å®¹ 1**: æ›´æ–° `fetchPending` å‡½æ•°ï¼Œä¿å­˜æ–°å­—æ®µ

```typescript
setWithdrawals(data.items.map((item) => ({
  id: item.id,
  address: item.address,
  amount: parseFloat(item.amount),
  status: item.status as 'Pending' | 'Completed' | 'Rejected',
  createdAt: new Date(item.createdAt).toLocaleString(),
  energyLockedAmount: parseFloat(item.energyLockedAmount || '0'), // ğŸŸ¢ æ–°å¢
  alert: item.alert || false, // ğŸŸ¢ æ–°å¢
  userStats: item.userStats, // ğŸŸ¢ æ–°å¢
})));
```

**ä¿®æ”¹å†…å®¹ 2**: æ·»åŠ äº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯å‡½æ•°

```typescript
// ğŸŸ¢ æ–°å¢ï¼šäº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯
const validateTxHash = (hash: string): boolean => {
  if (!hash) return false;
  // å¿…é¡»ä»¥ 0x å¼€å¤´ï¼Œé•¿åº¦ä¸º 66 å­—ç¬¦ï¼ˆ0x + 64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰
  return /^0x[a-fA-F0-9]{64}$/.test(hash);
};
```

**ä¿®æ”¹å†…å®¹ 3**: åœ¨ `handleCompleteApprove` ä¸­ä½¿ç”¨æ ¼å¼éªŒè¯

```typescript
const handleCompleteApprove = async () => {
  if (!activeWithdrawal || !txHash) return;
  
  // ğŸŸ¢ æ–°å¢ï¼šäº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯
  if (!validateTxHash(txHash)) {
    showNotification('error', 'äº¤æ˜“å“ˆå¸Œæ ¼å¼ä¸æ­£ç¡®ï¼Œå¿…é¡»ä»¥ 0x å¼€å¤´ï¼Œé•¿åº¦ä¸º 66 å­—ç¬¦');
    return;
  }
  
  // ... åç»­é€»è¾‘
};
```

**ä¿®æ”¹å†…å®¹ 4**: æ›´æ–°æç°å¡ç‰‡æ˜¾ç¤º

```typescript
<div className={`p-4 sm:p-6 flex flex-col gap-4 hover:bg-zinc-800/20 transition-colors ${w.alert ? 'border-l-4 border-yellow-500 bg-yellow-500/5' : ''}`}>
  {/* ğŸŸ¢ æ–°å¢ï¼šå‘Šè­¦æ ‡å¿— */}
  {w.alert && (
    <div className="flex items-center gap-2 text-yellow-500 text-xs font-bold">
      <AlertTriangle size={14} />
      <span>å¤§é¢æç°å‘Šè­¦</span>
    </div>
  )}
  
  {/* ... åŸæœ‰æ˜¾ç¤ºå†…å®¹ ... */}
  
  {/* ğŸŸ¢ æ–°å¢ï¼šæ˜¾ç¤ºé”å®šçš„èƒ½é‡å€¼ */}
  {w.energyLockedAmount !== undefined && w.energyLockedAmount > 0 && (
    <span className="text-xs text-red-400 font-bold">
      âš¡ -{w.energyLockedAmount} èƒ½é‡
    </span>
  )}
  
  {/* ğŸŸ¢ æ–°å¢ï¼šç”¨æˆ·ç”»åƒä¿¡æ¯æ  */}
  {w.userStats && (
    <div className="mt-3 p-3 bg-zinc-900/50 border border-zinc-800 rounded-lg">
      <div className="flex items-center gap-2 mb-2">
        <TrendingUp size={12} className="text-zinc-500" />
        <span className="text-[10px] font-bold text-zinc-500 uppercase tracking-wider">ç”¨æˆ·ç”»åƒ</span>
      </div>
      <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 text-xs">
        <div className="flex items-center gap-1.5">
          <Coins size={12} className="text-blue-400" />
          <div>
            <div className="text-zinc-500 text-[10px]">æŒä»“</div>
            <div className="text-white font-bold">{w.userStats.ratBalance.toLocaleString()} RAT</div>
          </div>
        </div>
        <div className="flex items-center gap-1.5">
          <Zap size={12} className="text-yellow-400" />
          <div>
            <div className="text-zinc-500 text-[10px]">èƒ½é‡</div>
            <div className="text-white font-bold">
              <span className="text-red-400">-{w.energyLockedAmount || 0}</span>
              <span className="text-zinc-500"> / </span>
              <span>{w.userStats.energyAvailable}</span>
            </div>
          </div>
        </div>
        <div className="flex items-center gap-1.5">
          <TrendingUp size={12} className="text-emerald-400" />
          <div>
            <div className="text-zinc-500 text-[10px]">ä½™é¢</div>
            <div className="text-white font-bold">${w.userStats.totalEarnings.toFixed(2)}</div>
          </div>
        </div>
        <div className="flex items-center gap-1.5">
          <Crown size={12} className="text-purple-400" />
          <div>
            <div className="text-zinc-500 text-[10px]">ç­‰çº§</div>
            <div className="text-white font-bold">
              {w.userStats.vipLevel > 0 ? `VIP ${w.userStats.vipLevel}` : 'NOVICE'}
            </div>
          </div>
        </div>
      </div>
    </div>
  )}
</div>
```

**ä¿®æ”¹å†…å®¹ 5**: äº¤æ˜“å“ˆå¸Œè¾“å…¥æ¡†æ·»åŠ æ ¼å¼éªŒè¯æç¤º

```typescript
<input 
  type="text" 
  placeholder="0x..."
  className={`w-full bg-zinc-950 border rounded-lg px-4 py-3 text-sm outline-none focus:ring-1 transition-all font-mono ${
    txHash && !validateTxHash(txHash) 
      ? 'border-red-500 focus:border-red-500 focus:ring-red-500' 
      : 'border-zinc-800 focus:border-emerald-500 focus:ring-emerald-500'
  }`}
  value={txHash}
  onChange={(e) => setTxHash(e.target.value)}
/>
{/* ğŸŸ¢ æ–°å¢ï¼šäº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯æç¤º */}
{txHash && !validateTxHash(txHash) && (
  <p className="text-xs text-red-400 flex items-center gap-1">
    <AlertTriangle size={12} />
    äº¤æ˜“å“ˆå¸Œæ ¼å¼ä¸æ­£ç¡®ï¼Œå¿…é¡»ä»¥ 0x å¼€å¤´ï¼Œé•¿åº¦ä¸º 66 å­—ç¬¦
  </p>
)}
```

**ä¿®æ”¹å†…å®¹ 6**: ç¡®è®¤æŒ‰é’®æ·»åŠ æ ¼å¼éªŒè¯ç¦ç”¨é€»è¾‘

```typescript
<button 
  onClick={handleCompleteApprove}
  disabled={!txHash || !validateTxHash(txHash) || processingId === activeWithdrawal.id}
  // ...
>
```

---

## ğŸ¨ UI å±•ç¤ºæ•ˆæœ

### 1. æç°å¡ç‰‡ï¼ˆæ— å‘Šè­¦ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¼ 0xAbc...1234                            â”‚
â”‚ $ 100.00 USDT  ç¼–å·: 1024  âš¡ -15 èƒ½é‡     â”‚
â”‚ ç”³è¯·äº 2026/01/07 18:30                    â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“Š ç”¨æˆ·ç”»åƒ                          â”‚   â”‚
â”‚ â”‚ ğŸ’° æŒä»“: 50,000 RAT                  â”‚   â”‚
â”‚ â”‚ âš¡ èƒ½é‡: -15 / 1,200                 â”‚   â”‚
â”‚ â”‚ ğŸ“ˆ ä½™é¢: $ 520.00                    â”‚   â”‚
â”‚ â”‚ ğŸ‘‘ ç­‰çº§: VIP 3                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚ [ æ‹’ç» ]  [ å‘æ”¾ (Release) ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æç°å¡ç‰‡ï¼ˆå¤§é¢å‘Šè­¦ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ å¤§é¢æç°å‘Šè­¦                             â”‚
â”‚ ğŸ’¼ 0xDef...5678                            â”‚
â”‚ $ 1,500.00 USDT  ç¼–å·: 1025  âš¡ -150 èƒ½é‡  â”‚
â”‚ ç”³è¯·äº 2026/01/07 19:00                    â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“Š ç”¨æˆ·ç”»åƒ                          â”‚   â”‚
â”‚ â”‚ ğŸ’° æŒä»“: 200,000 RAT                 â”‚   â”‚
â”‚ â”‚ âš¡ èƒ½é‡: -150 / 5,000                â”‚   â”‚
â”‚ â”‚ ğŸ“ˆ ä½™é¢: $ 2,500.00                  â”‚   â”‚
â”‚ â”‚ ğŸ‘‘ ç­‰çº§: VIP 4                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚ [ æ‹’ç» ]  [ å‘æ”¾ (Release) ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‘Šè­¦æ ·å¼**: å·¦ä¾§é»„è‰²è¾¹æ¡† + é»„è‰²èƒŒæ™¯é«˜äº®

### 3. äº¤æ˜“å“ˆå¸Œè¾“å…¥éªŒè¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº¤æ˜“å“ˆå¸Œ (TxHash)                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ 0x123...                            â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚ âš ï¸ äº¤æ˜“å“ˆå¸Œæ ¼å¼ä¸æ­£ç¡®ï¼Œå¿…é¡»ä»¥ 0x å¼€å¤´ï¼Œ      â”‚
â”‚    é•¿åº¦ä¸º 66 å­—ç¬¦                            â”‚
â”‚                                             â”‚
â”‚ [ å–æ¶ˆ ]  [ ç¡®è®¤å¹¶åŒæ­¥çŠ¶æ€ ] (ç¦ç”¨)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒè¯è§„åˆ™**:
- âœ… å¿…é¡»ä»¥ `0x` å¼€å¤´
- âœ… æ€»é•¿åº¦ä¸º 66 å­—ç¬¦ï¼ˆ`0x` + 64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰
- âœ… åªèƒ½åŒ…å« `0-9` å’Œ `a-f`ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰

---

## ğŸ“Š åŠŸèƒ½è¯´æ˜

### 1. æ˜¾ç¤ºé”å®šçš„èƒ½é‡å€¼

**ä½ç½®**: æç°é‡‘é¢æ—è¾¹  
**æ˜¾ç¤ºæ ¼å¼**: `âš¡ -15 èƒ½é‡`ï¼ˆçº¢è‰²é«˜äº®ï¼‰  
**æ•°æ®æ¥æº**: `energyLockedAmount` å­—æ®µ

**ä½œç”¨**: å¸®åŠ©ç®¡ç†å‘˜äº†è§£æœ¬æ¬¡æç°æ¶ˆè€—çš„èƒ½é‡æˆæœ¬

---

### 2. äº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯

**éªŒè¯æ—¶æœº**:
- è¾“å…¥æ—¶å®æ—¶éªŒè¯ï¼ˆè¾“å…¥æ¡†è¾¹æ¡†å˜çº¢ï¼‰
- æäº¤æ—¶å†æ¬¡éªŒè¯ï¼ˆæ˜¾ç¤ºé”™è¯¯æç¤ºï¼‰

**éªŒè¯è§„åˆ™**:
```typescript
/^0x[a-fA-F0-9]{64}$/
```

**ç”¨æˆ·ä½“éªŒ**:
- âœ… è¾“å…¥æ¡†è¾¹æ¡†é¢œè‰²å˜åŒ–ï¼ˆé”™è¯¯æ—¶çº¢è‰²ï¼‰
- âœ… å®æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
- âœ… ç¡®è®¤æŒ‰é’®è‡ªåŠ¨ç¦ç”¨ï¼ˆæ ¼å¼é”™è¯¯æ—¶ï¼‰

---

### 3. å‘Šè­¦åŠŸèƒ½ä½¿ç”¨

**è§¦å‘æ¡ä»¶**: æç°é‡‘é¢ >= 1000 USDTï¼ˆå¯é…ç½®ï¼‰

**æ˜¾ç¤ºæ•ˆæœ**:
- âœ… å·¦ä¾§é»„è‰²è¾¹æ¡†ï¼ˆ`border-l-4 border-yellow-500`ï¼‰
- âœ… é»„è‰²èƒŒæ™¯é«˜äº®ï¼ˆ`bg-yellow-500/5`ï¼‰
- âœ… å‘Šè­¦å›¾æ ‡å’Œæ–‡å­—æç¤º

**ä½œç”¨**: å¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿè¯†åˆ«å¤§é¢æç°ï¼Œè¿›è¡Œé‡ç‚¹å®¡æ ¸

---

### 4. ç”¨æˆ·ç”»åƒåŠŸèƒ½

**æ˜¾ç¤ºæŒ‡æ ‡**:

| æŒ‡æ ‡ | å›¾æ ‡ | æ•°æ®æ¥æº | è¯´æ˜ |
|------|------|---------|------|
| **æŒä»“** | ğŸ’° Coins | `rat_balance_wei` | RAT æŒä»“æ•°é‡ï¼ˆæ ¼å¼åŒ–æ˜¾ç¤ºï¼‰ |
| **èƒ½é‡** | âš¡ Zap | `energy_total - energy_locked` | æœ¬æ¬¡æ¶ˆè€—ï¼ˆçº¢è‰²ï¼‰ / å‰©ä½™èƒ½é‡ |
| **ä½™é¢** | ğŸ“ˆ TrendingUp | `usdt_total` | ç´¯è®¡æ”¶ç›Šä½™é¢ï¼ˆUSDTï¼‰ |
| **ç­‰çº§** | ğŸ‘‘ Crown | `getVipTierByBalance()` | VIP ç­‰çº§ï¼ˆ0 æ˜¾ç¤ºä¸º NOVICEï¼‰ |

**å¸ƒå±€**: Grid å¸ƒå±€ï¼Œç§»åŠ¨ç«¯ 2 åˆ—ï¼Œæ¡Œé¢ç«¯ 4 åˆ—

**ä½œç”¨**: 
- âœ… å¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸º"ç¾Šæ¯›å…š"
- âœ… è¯†åˆ«å¼‚å¸¸è´¦æˆ·ï¼ˆä¾‹å¦‚ï¼šæŒä»“å¾ˆå°‘ä½†é¢‘ç¹æç°ï¼‰
- âœ… è¯„ä¼°ç”¨æˆ·ä»·å€¼ï¼ˆæŒä»“ã€ç­‰çº§ï¼‰

---

## ğŸ” æ•°æ®æµç¨‹

### åç«¯æ•°æ®è·å–æµç¨‹

```
æŸ¥è¯¢å¾…å®¡æ ¸æç°åˆ—è¡¨ (withdrawals è¡¨)
    â†“
æå–æ‰€æœ‰ç”¨æˆ·åœ°å€
    â†“
æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·æ•°æ® (users è¡¨)
    â”œâ”€ rat_balance_wei (RAT æŒä»“)
    â”œâ”€ energy_total (æ€»èƒ½é‡)
    â”œâ”€ energy_locked (é”å®šèƒ½é‡)
    â””â”€ usdt_total (ç´¯è®¡æ”¶ç›Š)
    â†“
è®¡ç®—ç”¨æˆ·ç”»åƒ
    â”œâ”€ RAT æŒä»“: formatEther(rat_balance_wei)
    â”œâ”€ å¯ç”¨èƒ½é‡: energy_total - energy_locked
    â”œâ”€ ç´¯è®¡æ”¶ç›Š: usdt_total
    â””â”€ VIP ç­‰çº§: getVipTierByBalance(ratBalance)
    â†“
åˆå¹¶è¿”å›ç»“æœ
    â”œâ”€ åŸæœ‰å­—æ®µ
    â”œâ”€ energyLockedAmount
    â”œâ”€ alert
    â””â”€ userStats
```

---

## âœ… ä¼˜åŒ–æ€»ç»“

### å·²å®Œæˆçš„ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| **æ˜¾ç¤ºé”å®šçš„èƒ½é‡å€¼** | âœ… | åœ¨æç°é‡‘é¢æ—è¾¹æ˜¾ç¤ºï¼Œçº¢è‰²é«˜äº® |
| **äº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯** | âœ… | å‰ç«¯å®æ—¶éªŒè¯ï¼Œæä¾›é”™è¯¯æç¤º |
| **å‘Šè­¦åŠŸèƒ½ä½¿ç”¨** | âœ… | å¤§é¢æç°æ˜¾ç¤ºå‘Šè­¦æ ‡å¿—å’Œç‰¹æ®Šæ ·å¼ |
| **ç”¨æˆ·ç”»åƒåŠŸèƒ½** | âœ… | æ˜¾ç¤ºæŒä»“ã€èƒ½é‡ã€æ”¶ç›Šã€VIPç­‰çº§ |

### ç”¨æˆ·ä½“éªŒæå‡

- âœ… **ä¿¡æ¯æ›´å®Œæ•´**: ç®¡ç†å‘˜å¯ä»¥ä¸€çœ¼çœ‹åˆ°ç”¨æˆ·çš„å…³é”®ä¿¡æ¯
- âœ… **å®¡æ ¸æ›´é«˜æ•ˆ**: å¿«é€Ÿè¯†åˆ«å¼‚å¸¸è´¦æˆ·å’Œç¾Šæ¯›å…š
- âœ… **é”™è¯¯æ›´å°‘**: äº¤æ˜“å“ˆå¸Œæ ¼å¼éªŒè¯å‡å°‘è¾“å…¥é”™è¯¯
- âœ… **é£é™©å¯æ§**: å¤§é¢æç°å‘Šè­¦æé†’é‡ç‚¹å®¡æ ¸

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### åç«¯éƒ¨ç½²

1. **æäº¤ä»£ç **:
   ```bash
   cd rabbit-ai-backend
   git add src/services/admin.ts
   git commit -m "feat: è´¢åŠ¡å®¡æ ¸æ·»åŠ ç”¨æˆ·ç”»åƒæ•°æ®æ”¯æŒ"
   git push origin main
   ```

2. **è‡ªåŠ¨éƒ¨ç½²**: Render ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç å˜æ›´å¹¶é‡æ–°éƒ¨ç½²

### å‰ç«¯éƒ¨ç½²

1. **æäº¤ä»£ç **:
   ```bash
   cd rabbit-ai-admin
   git add types.ts lib/api.ts pages/FinanceOps.tsx
   git commit -m "feat: è´¢åŠ¡å®¡æ ¸ä¼˜åŒ– - ç”¨æˆ·ç”»åƒã€èƒ½é‡æ˜¾ç¤ºã€æ ¼å¼éªŒè¯ã€å‘Šè­¦"
   git push origin main
   ```

2. **è‡ªåŠ¨éƒ¨ç½²**: Vercel/Netlify ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç å˜æ›´å¹¶é‡æ–°éƒ¨ç½²

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘

**æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–**:
- âœ… ä½¿ç”¨ `IN` æŸ¥è¯¢ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ç”¨æˆ·æ•°æ®
- âœ… ä½¿ç”¨ `Map` æ•°æ®ç»“æ„å¿«é€ŸæŸ¥æ‰¾
- âœ… é¿å… N+1 æŸ¥è¯¢é—®é¢˜

**å»ºè®®**:
- å¦‚æœå¾…å®¡æ ¸æç°æ•°é‡å¾ˆå¤§ï¼ˆ> 100ï¼‰ï¼Œå¯ä»¥è€ƒè™‘åˆ†é¡µæˆ–é™åˆ¶æŸ¥è¯¢æ•°é‡

---

### 2. æ•°æ®å‡†ç¡®æ€§

**RAT æŒä»“**:
- âœ… ä» `rat_balance_wei` å­—æ®µè¯»å–ï¼ˆé“¾ä¸ŠåŒæ­¥æ•°æ®ï¼‰
- âœ… ä½¿ç”¨ `formatEther` è½¬æ¢ä¸ºå¯è¯»æ ¼å¼

**èƒ½é‡æ•°æ®**:
- âœ… ä» `users` è¡¨å®æ—¶è¯»å–
- âœ… è®¡ç®—å¯ç”¨èƒ½é‡ = æ€»èƒ½é‡ - é”å®šèƒ½é‡

**VIP ç­‰çº§**:
- âœ… ä½¿ç”¨ `getVipTierByBalance` å‡½æ•°è®¡ç®—
- âœ… åŸºäºå½“å‰ RAT æŒä»“åŒ¹é…ç­‰çº§

---

### 3. å‘Šè­¦é˜ˆå€¼é…ç½®

**å½“å‰é…ç½®**: 1000 USDTï¼ˆä» `config.withdrawAlertThreshold` è¯»å–ï¼‰

**ä¿®æ”¹æ–¹å¼**: åœ¨ç³»ç»Ÿé…ç½®ä¸­ä¿®æ”¹ `withdrawAlertThreshold` å€¼

---

## ğŸ‰ æ€»ç»“

æˆåŠŸå®æ–½äº†è´¢åŠ¡å®¡æ ¸åŠŸèƒ½çš„ä¼˜åŒ–å’Œæ–°åŠŸèƒ½æ·»åŠ ï¼š

- âœ… **3ä¸ªä¼˜åŒ–é¡¹å…¨éƒ¨å®Œæˆ**: èƒ½é‡æ˜¾ç¤ºã€æ ¼å¼éªŒè¯ã€å‘Šè­¦åŠŸèƒ½
- âœ… **ç”¨æˆ·ç”»åƒåŠŸèƒ½å®Œæ•´**: æŒä»“ã€èƒ½é‡ã€æ”¶ç›Šã€VIPç­‰çº§ä¸€ç›®äº†ç„¶
- âœ… **ç”¨æˆ·ä½“éªŒæå‡**: ä¿¡æ¯æ›´å®Œæ•´ï¼Œå®¡æ ¸æ›´é«˜æ•ˆ
- âœ… **ä»£ç è´¨é‡**: æ— è¯­æ³•é”™è¯¯ï¼Œç±»å‹å®šä¹‰å®Œæ•´

**å®æ–½éš¾åº¦**: ğŸŸ¢ Lowï¼ˆä¸»è¦æ˜¯æ•°æ®å±•ç¤ºå’ŒéªŒè¯é€»è¾‘ï¼‰  
**å®æ–½æ—¶é—´**: çº¦ 45 åˆ†é’Ÿ  
**å½±å“èŒƒå›´**: ä»…å½±å“è´¢åŠ¡å®¡æ ¸é¡µé¢ï¼Œä¸å½±å“å…¶ä»–åŠŸèƒ½

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-07  
**å®æ–½äºº**: AI Assistant  
**å®¡æŸ¥çŠ¶æ€**: âœ… å·²å®Œæˆä»£ç ä¿®æ”¹ï¼Œå¾…éƒ¨ç½²éªŒè¯

