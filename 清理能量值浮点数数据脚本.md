# æ¸…ç†èƒ½é‡å€¼æµ®ç‚¹æ•°æ•°æ®è„šæœ¬

## ğŸ“‹ è„šæœ¬è¯´æ˜

**ç›®çš„**ï¼šæ¸…ç†æ•°æ®åº“ä¸­ç°æœ‰çš„æµ®ç‚¹æ•°èƒ½é‡å€¼æ•°æ®ï¼Œç¡®ä¿æ‰€æœ‰èƒ½é‡å€¼éƒ½æ˜¯æ•´æ•°

**æ‰§è¡Œæ—¶æœº**ï¼šåœ¨åç«¯ä»£ç ä¿®å¤åç«‹å³æ‰§è¡Œ

---

## ğŸ” æ£€æŸ¥å—å½±å“çš„æ•°æ®

### 1. æ£€æŸ¥ users è¡¨

```sql
-- æŸ¥çœ‹å—å½±å“çš„ç”¨æˆ·æ•°é‡
SELECT COUNT(*) as affected_users_count
FROM users
WHERE energy_total != FLOOR(energy_total) 
   OR energy_locked != FLOOR(energy_locked);

-- æŸ¥çœ‹å—å½±å“çš„ç”¨æˆ·è¯¦æƒ…
SELECT 
  address,
  energy_total,
  FLOOR(energy_total) as energy_total_cleaned,
  energy_locked,
  FLOOR(energy_locked) as energy_locked_cleaned,
  updated_at
FROM users
WHERE energy_total != FLOOR(energy_total) 
   OR energy_locked != FLOOR(energy_locked)
ORDER BY updated_at DESC;
```

### 2. æ£€æŸ¥ withdrawals è¡¨

```sql
-- æŸ¥çœ‹å—å½±å“çš„æç°è®°å½•æ•°é‡
SELECT COUNT(*) as affected_withdrawals_count
FROM withdrawals
WHERE energy_locked_amount != FLOOR(energy_locked_amount);

-- æŸ¥çœ‹å—å½±å“çš„æç°è®°å½•è¯¦æƒ…
SELECT 
  id,
  address,
  amount,
  energy_locked_amount,
  CEIL(energy_locked_amount) as energy_locked_amount_cleaned,
  status,
  created_at
FROM withdrawals
WHERE energy_locked_amount != FLOOR(energy_locked_amount)
ORDER BY created_at DESC
LIMIT 20;
```

---

## ğŸ”§ æ¸…ç†è„šæœ¬

### âš ï¸ æ‰§è¡Œå‰å¤‡ä»½

```sql
-- å¤‡ä»½ users è¡¨ï¼ˆå¯é€‰ï¼‰
CREATE TABLE users_backup_20260105 AS 
SELECT * FROM users 
WHERE energy_total != FLOOR(energy_total) 
   OR energy_locked != FLOOR(energy_locked);

-- å¤‡ä»½ withdrawals è¡¨ï¼ˆå¯é€‰ï¼‰
CREATE TABLE withdrawals_backup_20260105 AS 
SELECT * FROM withdrawals 
WHERE energy_locked_amount != FLOOR(energy_locked_amount);
```

### 1. æ¸…ç† users è¡¨

```sql
-- ğŸŸ¢ æ¸…ç† users è¡¨ä¸­çš„æµ®ç‚¹æ•°èƒ½é‡å€¼
-- ä½¿ç”¨ FLOOR() å‘ä¸‹å–æ•´ï¼Œå¯¹ç”¨æˆ·æ›´å‹å¥½
UPDATE users
SET 
  energy_total = FLOOR(energy_total),
  energy_locked = FLOOR(energy_locked),
  updated_at = NOW()
WHERE energy_total != FLOOR(energy_total) 
   OR energy_locked != FLOOR(energy_locked);

-- æŸ¥çœ‹å—å½±å“çš„è¡Œæ•°
-- åº”è¯¥æ˜¾ç¤ºæ›´æ–°äº†å¤šå°‘è¡Œ
```

### 2. æ¸…ç† withdrawals è¡¨

```sql
-- ğŸŸ¢ æ¸…ç† withdrawals è¡¨ä¸­çš„æµ®ç‚¹æ•°èƒ½é‡å€¼
-- ä½¿ç”¨ CEIL() å‘ä¸Šå–æ•´ï¼Œä¸æ–°çš„æç°é€»è¾‘ä¿æŒä¸€è‡´
UPDATE withdrawals
SET 
  energy_locked_amount = CEIL(energy_locked_amount)
WHERE energy_locked_amount != FLOOR(energy_locked_amount);

-- æŸ¥çœ‹å—å½±å“çš„è¡Œæ•°
-- åº”è¯¥æ˜¾ç¤ºæ›´æ–°äº†å¤šå°‘è¡Œ
```

---

## âœ… éªŒè¯æ¸…ç†ç»“æœ

### 1. éªŒè¯ users è¡¨

```sql
-- éªŒè¯ users è¡¨ï¼šåº”è¯¥è¿”å› 0
SELECT COUNT(*) as remaining_float_users
FROM users
WHERE energy_total != FLOOR(energy_total) 
   OR energy_locked != FLOOR(energy_locked);

-- ç»“æœåº”è¯¥æ˜¯ï¼šremaining_float_users = 0
```

### 2. éªŒè¯ withdrawals è¡¨

```sql
-- éªŒè¯ withdrawals è¡¨ï¼šåº”è¯¥è¿”å› 0
SELECT COUNT(*) as remaining_float_withdrawals
FROM withdrawals
WHERE energy_locked_amount != FLOOR(energy_locked_amount);

-- ç»“æœåº”è¯¥æ˜¯ï¼šremaining_float_withdrawals = 0
```

### 3. æŠ½æ ·æ£€æŸ¥

```sql
-- æŠ½æ ·æ£€æŸ¥ï¼šæŸ¥çœ‹æœ€è¿‘æ›´æ–°çš„ç”¨æˆ·
SELECT 
  address,
  energy_total,
  energy_locked,
  updated_at
FROM users
ORDER BY updated_at DESC
LIMIT 10;

-- ç¡®è®¤ energy_total å’Œ energy_locked éƒ½æ˜¯æ•´æ•°
```

---

## ğŸ“Š æ‰§è¡Œè®¡åˆ’

### æ­¥éª¤ 1ï¼šæ£€æŸ¥å—å½±å“çš„æ•°æ®

1. æ‰§è¡Œ"æ£€æŸ¥ users è¡¨"SQL
2. æ‰§è¡Œ"æ£€æŸ¥ withdrawals è¡¨"SQL
3. è®°å½•å—å½±å“çš„æ•°æ®é‡

### æ­¥éª¤ 2ï¼šå¤‡ä»½æ•°æ®ï¼ˆå¯é€‰ï¼‰

1. æ‰§è¡Œå¤‡ä»½ SQL
2. ç¡®è®¤å¤‡ä»½è¡¨å·²åˆ›å»º

### æ­¥éª¤ 3ï¼šæ‰§è¡Œæ¸…ç†è„šæœ¬

1. æ‰§è¡Œ"æ¸…ç† users è¡¨"SQL
2. è®°å½•æ›´æ–°çš„è¡Œæ•°
3. æ‰§è¡Œ"æ¸…ç† withdrawals è¡¨"SQL
4. è®°å½•æ›´æ–°çš„è¡Œæ•°

### æ­¥éª¤ 4ï¼šéªŒè¯æ¸…ç†ç»“æœ

1. æ‰§è¡Œ"éªŒè¯ users è¡¨"SQL
2. ç¡®è®¤ç»“æœä¸º 0
3. æ‰§è¡Œ"éªŒè¯ withdrawals è¡¨"SQL
4. ç¡®è®¤ç»“æœä¸º 0
5. æ‰§è¡ŒæŠ½æ ·æ£€æŸ¥ SQL

---

## ğŸ¯ é¢„æœŸç»“æœ

### æ¸…ç†å‰

**users è¡¨**ï¼š
- `energy_total` = 56.099999999999994 âŒ
- `energy_locked` = 9.9 âŒ

**withdrawals è¡¨**ï¼š
- `energy_locked_amount` = 9.9 âŒ

### æ¸…ç†å

**users è¡¨**ï¼š
- `energy_total` = 56 âœ…
- `energy_locked` = 9 âœ…

**withdrawals è¡¨**ï¼š
- `energy_locked_amount` = 10 âœ…

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸€è‡´æ€§

- âœ… `users.energy_total` ä½¿ç”¨ `FLOOR()` å‘ä¸‹å–æ•´ï¼ˆå¯¹ç”¨æˆ·æ›´å‹å¥½ï¼‰
- âœ… `users.energy_locked` ä½¿ç”¨ `FLOOR()` å‘ä¸‹å–æ•´ï¼ˆå¯¹ç”¨æˆ·æ›´å‹å¥½ï¼‰
- âœ… `withdrawals.energy_locked_amount` ä½¿ç”¨ `CEIL()` å‘ä¸Šå–æ•´ï¼ˆä¸æ–°é€»è¾‘ä¸€è‡´ï¼‰

### 2. æ‰§è¡Œæ—¶æœº

- âš ï¸ å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼ˆé¿å…å½±å“ç”¨æˆ·ä½“éªŒï¼‰
- âš ï¸ å»ºè®®åœ¨åç«¯ä»£ç éƒ¨ç½²åç«‹å³æ‰§è¡Œï¼ˆç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰

### 3. å›æ»šè®¡åˆ’

- âœ… å¦‚æœéœ€è¦å›æ»šï¼Œå¯ä»¥ä»å¤‡ä»½è¡¨æ¢å¤æ•°æ®
- âœ… å¤‡ä»½è¡¨ä¿ç•™ 7 å¤©ååˆ é™¤

```sql
-- å›æ»š SQLï¼ˆå¦‚æœéœ€è¦ï¼‰
UPDATE users u
SET 
  energy_total = b.energy_total,
  energy_locked = b.energy_locked,
  updated_at = b.updated_at
FROM users_backup_20260105 b
WHERE u.address = b.address;

UPDATE withdrawals w
SET 
  energy_locked_amount = b.energy_locked_amount
FROM withdrawals_backup_20260105 b
WHERE w.id = b.id;
```

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] æ‰§è¡Œ"æ£€æŸ¥å—å½±å“çš„æ•°æ®"SQL
- [ ] è®°å½•å—å½±å“çš„æ•°æ®é‡
- [ ] æ‰§è¡Œå¤‡ä»½ SQLï¼ˆå¯é€‰ï¼‰
- [ ] ç¡®è®¤å¤‡ä»½è¡¨å·²åˆ›å»º
- [ ] æ‰§è¡Œ"æ¸…ç† users è¡¨"SQL
- [ ] è®°å½• users è¡¨æ›´æ–°çš„è¡Œæ•°
- [ ] æ‰§è¡Œ"æ¸…ç† withdrawals è¡¨"SQL
- [ ] è®°å½• withdrawals è¡¨æ›´æ–°çš„è¡Œæ•°
- [ ] æ‰§è¡Œ"éªŒè¯ users è¡¨"SQLï¼Œç¡®è®¤ç»“æœä¸º 0
- [ ] æ‰§è¡Œ"éªŒè¯ withdrawals è¡¨"SQLï¼Œç¡®è®¤ç»“æœä¸º 0
- [ ] æ‰§è¡ŒæŠ½æ ·æ£€æŸ¥ SQL
- [ ] éªŒè¯å‰ç«¯æ˜¾ç¤ºèƒ½é‡å€¼ä¸ºæ•´æ•°

---

**è„šæœ¬åˆ›å»ºæ—¶é—´**ï¼š2026-01-05  
**è„šæœ¬çŠ¶æ€**ï¼šâœ… å·²åˆ›å»ºï¼Œå¾…æ‰§è¡Œ  
**ä¼˜å…ˆçº§**ï¼šé«˜  
**å»ºè®®æ‰§è¡Œæ—¶é—´**ï¼šåç«¯ä»£ç éƒ¨ç½²åç«‹å³æ‰§è¡Œ

