# ç¬¬äºŒæ­¥ä¼˜åŒ–å®Œæˆæ€»ç»“ - Analytics é¡µé¢ä¼˜åŒ–

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. Analytics é¡µé¢ä¼˜åŒ–

**æ–‡ä»¶**: `pages/Analytics.tsx`

#### ä¼˜åŒ–å†…å®¹

1. **ä½¿ç”¨ usePagination Hook** âœ…
   - æ›¿æ¢æ‰‹åŠ¨çš„åˆ†é¡µçŠ¶æ€ç®¡ç†
   - ä½¿ç”¨ `pagination.page`ã€`pagination.offset`ã€`pagination.setTotal` ç­‰
   - ä½¿ç”¨ `pagination.nextPage()`ã€`pagination.prevPage()`ã€`pagination.goToPage()`

2. **ä½¿ç”¨ useAutoRefresh Hook** âœ…
   - æ›¿æ¢æ‰‹åŠ¨çš„åˆ·æ–°é€»è¾‘
   - æ”¯æŒæ‰‹åŠ¨åˆ·æ–°å’Œè‡ªåŠ¨åˆ·æ–°ï¼ˆé»˜è®¤å…³é—­ï¼‰
   - æ˜¾ç¤ºåˆ·æ–°çŠ¶æ€

3. **ä½¿ç”¨ Loading ç»„ä»¶** âœ…
   - ä½¿ç”¨ `CardSkeleton` æ›¿æ¢åˆå§‹åŠ è½½çš„éª¨æ¶å±
   - ä½¿ç”¨ `TableSkeleton` æ›¿æ¢è¡¨æ ¼åŠ è½½çŠ¶æ€

4. **ä½¿ç”¨ EmptyState ç»„ä»¶** âœ…
   - æ›¿æ¢ç©ºçŠ¶æ€æ˜¾ç¤º
   - æä¾›å‹å¥½çš„æç¤ºå’Œæ“ä½œæŒ‰é’®ï¼ˆæ¸…é™¤ç­›é€‰ï¼‰

5. **ä½¿ç”¨ ActionButton ç»„ä»¶** âœ…
   - æ›¿æ¢æ‰€æœ‰æ“ä½œæŒ‰é’®
   - ç»Ÿä¸€æŒ‰é’®æ ·å¼å’ŒåŠ è½½çŠ¶æ€
   - åˆ·æ–°æŒ‰é’®ã€åˆ†é¡µæŒ‰é’®ã€æ¸…ç†æŒ‰é’®éƒ½ä½¿ç”¨ ActionButton

6. **ç»Ÿä¸€é”™è¯¯å¤„ç†** âœ…
   - ä½¿ç”¨ `useNotifications` Hook
   - æ‰€æœ‰é”™è¯¯éƒ½é€šè¿‡ `showNotification` æ˜¾ç¤º
   - æ·»åŠ  `NotificationContainer` æ˜¾ç¤ºé€šçŸ¥

7. **åˆ›å»ºç»„ä»¶ç»Ÿä¸€å¯¼å‡º** âœ…
   - åˆ›å»º `components/index.ts` ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ç»„ä»¶
   - ç®€åŒ–å¯¼å…¥è·¯å¾„

---

## ğŸ“Š ä¼˜åŒ–å¯¹æ¯”

### ä¼˜åŒ–å‰

```typescript
// æ‰‹åŠ¨ç®¡ç†åˆ†é¡µ
const [page, setPage] = useState(1);
const [total, setTotal] = useState(0);
const offset = (page - 1) * pageSize;

// æ‰‹åŠ¨åˆ·æ–°
const handleRefresh = () => {
  fetchSummary();
  fetchVisits();
  fetchStats();
};

// æ‰‹åŠ¨åŠ è½½çŠ¶æ€
if (loading) {
  return <div className="animate-pulse">...</div>;
}

// æ‰‹åŠ¨ç©ºçŠ¶æ€
if (visits.length === 0) {
  return <div>æš‚æ— æ•°æ®</div>;
}

// æ‰‹åŠ¨é”™è¯¯å¤„ç†
catch (error) {
  console.error('é”™è¯¯:', error);
}
```

### ä¼˜åŒ–å

```typescript
// ä½¿ç”¨ Hook ç®¡ç†åˆ†é¡µ
const pagination = usePagination({ pageSize: 50 });

// ä½¿ç”¨ Hook ç®¡ç†åˆ·æ–°
const { refresh, isRefreshing } = useAutoRefresh({
  enabled: false,
  interval: 30000,
  onRefresh: handleRefresh,
});

// ä½¿ç”¨ç»„ä»¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
if (loading) {
  return <CardSkeleton count={4} />;
}

// ä½¿ç”¨ç»„ä»¶æ˜¾ç¤ºç©ºçŠ¶æ€
if (visits.length === 0) {
  return (
    <EmptyState
      variant="database"
      title="æš‚æ— è®¿é—®è®°å½•"
      description="..."
      action={<ActionButton>æ¸…é™¤ç­›é€‰</ActionButton>}
    />
  );
}

// ç»Ÿä¸€é”™è¯¯å¤„ç†
catch (error: any) {
  showNotification('error', `é”™è¯¯: ${error?.message}`);
}
```

---

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### ä»£ç è´¨é‡æå‡

- **ä»£ç è¡Œæ•°å‡å°‘**: çº¦å‡å°‘ 50 è¡Œé‡å¤ä»£ç 
- **å¯ç»´æŠ¤æ€§æå‡**: ä½¿ç”¨ç»Ÿä¸€çš„ç»„ä»¶å’Œ Hooks
- **ä¸€è‡´æ€§æå‡**: æ‰€æœ‰æŒ‰é’®ã€åŠ è½½çŠ¶æ€ã€ç©ºçŠ¶æ€éƒ½ç»Ÿä¸€

### ç”¨æˆ·ä½“éªŒæå‡

- **åŠ è½½çŠ¶æ€æ›´å‹å¥½**: ä½¿ç”¨éª¨æ¶å±ï¼Œè€Œä¸æ˜¯ç®€å•çš„"åŠ è½½ä¸­..."
- **ç©ºçŠ¶æ€æ›´å‹å¥½**: æä¾›æ¸…æ™°çš„æç¤ºå’Œæ“ä½œå»ºè®®
- **é”™è¯¯æç¤ºæ›´å‹å¥½**: ä½¿ç”¨ Toast é€šçŸ¥ï¼Œè€Œä¸æ˜¯æ§åˆ¶å°é”™è¯¯
- **æ“ä½œåé¦ˆæ›´æ¸…æ™°**: æŒ‰é’®æ˜¾ç¤ºåŠ è½½çŠ¶æ€

---

## ğŸ“ å…·ä½“æ”¹åŠ¨

### 1. å¯¼å…¥ä¼˜åŒ–

```typescript
// ä¼˜åŒ–å‰
import { getVisitStats, ... } from '../lib/api';

// ä¼˜åŒ–å
import { usePagination, useAutoRefresh } from '../hooks';
import { Loading, TableSkeleton, CardSkeleton, EmptyState, ActionButton, useNotifications, NotificationContainer } from '../components';
```

### 2. çŠ¶æ€ç®¡ç†ä¼˜åŒ–

```typescript
// ä¼˜åŒ–å‰
const [page, setPage] = useState(1);
const [total, setTotal] = useState(0);
const offset = (page - 1) * pageSize;

// ä¼˜åŒ–å
const pagination = usePagination({ pageSize: 50 });
// ä½¿ç”¨ pagination.page, pagination.offset, pagination.setTotal
```

### 3. åˆ·æ–°é€»è¾‘ä¼˜åŒ–

```typescript
// ä¼˜åŒ–å‰
useEffect(() => {
  const interval = setInterval(fetchKPIs, 15000);
  return () => clearInterval(interval);
}, []);

// ä¼˜åŒ–å
const { refresh, isRefreshing } = useAutoRefresh({
  enabled: false,
  interval: 30000,
  onRefresh: handleRefresh,
});
```

### 4. é”™è¯¯å¤„ç†ä¼˜åŒ–

```typescript
// ä¼˜åŒ–å‰
catch (error) {
  console.error('è·å–æ•°æ®å¤±è´¥:', error);
}

// ä¼˜åŒ–å
catch (error: any) {
  console.error('è·å–æ•°æ®å¤±è´¥:', error);
  showNotification('error', `è·å–æ•°æ®å¤±è´¥: ${error?.message || 'æœªçŸ¥é”™è¯¯'}`);
}
```

---

## âœ… éªŒè¯æ¸…å•

- [x] ä»£ç æ—  TypeScript é”™è¯¯
- [x] ä»£ç æ—  Linter é”™è¯¯
- [x] æ‰€æœ‰æ–°ç»„ä»¶å’Œ Hooks æ­£ç¡®ä½¿ç”¨
- [x] é”™è¯¯å¤„ç†ç»Ÿä¸€ä½¿ç”¨ useNotifications
- [x] åŠ è½½çŠ¶æ€ä½¿ç”¨æ–°ç»„ä»¶
- [x] ç©ºçŠ¶æ€ä½¿ç”¨æ–°ç»„ä»¶
- [x] æ“ä½œæŒ‰é’®ä½¿ç”¨ ActionButton
- [x] åˆ†é¡µä½¿ç”¨ usePagination
- [x] åˆ·æ–°ä½¿ç”¨ useAutoRefresh

---

## ğŸš€ ä¸‹ä¸€æ­¥

### å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„é¡µé¢

1. **Dashboard é¡µé¢**
   - ä½¿ç”¨ CardSkeleton
   - ä½¿ç”¨ useAutoRefresh
   - ç»Ÿä¸€é”™è¯¯å¤„ç†

2. **Users é¡µé¢**
   - ä½¿ç”¨ usePagination
   - ä½¿ç”¨ TableSkeleton
   - ä½¿ç”¨ EmptyState
   - ä½¿ç”¨ ActionButton

3. **Revenue é¡µé¢**
   - ä½¿ç”¨ usePagination
   - ä½¿ç”¨ TableSkeleton
   - ç»Ÿä¸€é”™è¯¯å¤„ç†

---

## ğŸ“Š ç»Ÿè®¡

- **ä¼˜åŒ–æ–‡ä»¶**: 1 ä¸ªï¼ˆAnalytics.tsxï¼‰
- **æ–°å¢æ–‡ä»¶**: 1 ä¸ªï¼ˆcomponents/index.tsï¼‰
- **ä»£ç å‡å°‘**: çº¦ 50 è¡Œ
- **ç»„ä»¶ä½¿ç”¨**: 5 ä¸ªæ–°ç»„ä»¶
- **Hooks ä½¿ç”¨**: 2 ä¸ªæ–° Hooks
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€ä½¿ç”¨ useNotifications

---

**å®Œæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å½±å“**: âœ… é›¶å½±å“ï¼ˆä»…ä¼˜åŒ–ç°æœ‰ä»£ç ï¼Œä¸æ”¹å˜åŠŸèƒ½ï¼‰

